**Дата:** 20 декабря 2025 г.

**Статус:** На проверке

**Контекст:**

Для обеспечения надёжности, стабильности и качества платформы «Спортивная Статистика» необходимо внедрить стратегию автоматического тестирования на всех уровнях: от unit-тестов до end-to-end сценариев. Учитывая микросервисную архитектуру, разнообразие пользовательских ролей (тренеры, аналитики, фанаты и др.) и критическую важность точности данных, автоматизация тестирования - ключевой элемент CI/CD-процесса.

**Рассмотренные варианты:**

**Для бэкенда (Python):**

- pytest: современный, гибкий и расширяемый фреймворк с отличной поддержкой асинхронности, фикстур и параметризованных тестов.
- unittest: встроенный в Python фреймворк, но менее выразительный и удобный по сравнению с pytest.
- Nose2: устаревающий инструмент без активного развития.

**Для фронтенда (React + TypeScript):**

- Vitest: быстрый, современный тест-раннер, нативно совместимый с Vite, TypeScript и React (через @testing-library/react).
- Jest: зрелый и популярный инструмент, но медленнее из-за избыточной настройки и отсутствия родной поддержки ESM.
- React Testing Library: не тест-раннер, а библиотека для тестирования компонентов; будет использоваться в связке с Vitest.

**Для end-to-end (E2E) тестирования:**

- Playwright: современный, быстрый и надёжный инструмент от Microsoft с поддержкой нескольких браузеров, встроенным ожиданием элементов и возможностью тестировать мобильные представления.
- Cypress: удобный, но ограниченный одним браузером (Chromium) и менее гибкий в сложных сценариях (например, мультидоменные сессии).
- Selenium: устаревший подход с высокой сложностью поддержки и медленным выполнением.

**Для тестирования API (интеграционные/контрактные тесты):**

- pytest + httpx: для прямого вызова микросервисов в интеграционных тестах.
- Postman + Newman: менее удобен для автоматизации в CI.
- Pact: подходит для контрактного тестирования между микросервисами, но избыточен на текущем этапе.

**Решение:**

Выбранные варианты: 
- Backend: pytest
- Frontend: Vitest
- E2E: Playwright
- Интеграционные тесты API: pytest

**Обоснование:**

- pytest: стандарт в Python-сообществе, особенно в проектах с FastAPI. Поддерживает асинхронные тесты, легко масштабируется и интегрируется с CI.
- Vitest: идеально сочетается с Vite и TypeScript, обеспечивает мгновенный запуск тестов и горячую перезагрузку: критично для быстрой обратной связи при разработке сложных дашбордов.
- Playwright: обеспечивает стабильные, быстрые и кроссплатформенные E2E-тесты, включая сценарии в реальном времени (например, обновление счёта во время матча).
- MSW (Mock Service Worker): позволяет имитировать API-вызовы на уровне Service Worker, что делает фронтенд-тесты независимыми от бэкенда и очень быстрыми.
- Все выбранные инструменты open-source, активно развиваются и имеют сильное сообщество.

**Последствия:**

**+**

- Высокое покрытие unit- и интеграционными тестами, что снижает риск ошибок в аналитике и прогнозах.
- Упрощённая отладка и поддержка тестов за счёт единообразия и типизации (TypeScript + Pydantic-модели в Python).
- Возможность запускать E2E-тесты в CI на разных браузерах и устройствах.

**-**

- Требуется обучение команды лучшим практикам тестирования (например, избегать избыточных E2E-тестов в ущерб unit-покрытиию).
- Необходимость настройки и поддержки тестовых окружений (особенно для микросервисов с PostgreSQL).